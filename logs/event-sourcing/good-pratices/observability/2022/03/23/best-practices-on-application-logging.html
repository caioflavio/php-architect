<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Melhorando a observabilidade: Boas práticas na escrita de LOGS | PHP Architect</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Melhorando a observabilidade: Boas práticas na escrita de LOGS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introdução" />
<meta property="og:description" content="Introdução" />
<link rel="canonical" href="/php-architect/logs/event-sourcing/good-pratices/observability/2022/03/23/best-practices-on-application-logging.html" />
<meta property="og:url" content="/php-architect/logs/event-sourcing/good-pratices/observability/2022/03/23/best-practices-on-application-logging.html" />
<meta property="og:site_name" content="PHP Architect" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-23T14:34:51+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Melhorando a observabilidade: Boas práticas na escrita de LOGS" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-23T14:34:51+00:00","datePublished":"2022-03-23T14:34:51+00:00","description":"Introdução","headline":"Melhorando a observabilidade: Boas práticas na escrita de LOGS","mainEntityOfPage":{"@type":"WebPage","@id":"/php-architect/logs/event-sourcing/good-pratices/observability/2022/03/23/best-practices-on-application-logging.html"},"url":"/php-architect/logs/event-sourcing/good-pratices/observability/2022/03/23/best-practices-on-application-logging.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/php-architect/assets/css/main.css">
  <script src="/php-architect/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="/php-architect/feed.xml" title="PHP Architect" /><link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8"
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner"><span class="site-brand"><a class="site-brand-inner" rel="author" href="/php-architect/">
  <img class="site-favicon" title="PHP Architect" src="" onerror="this.style.display='none'">
  PHP Architect
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>

          <div class="trigger">




</div>
        </nav></div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Melhorando a observabilidade: Boas práticas na escrita de LOGS</h1>
  <h2 class="post-subtitle"></h2>

  <p class="post-meta">
    <time class="dt-published" datetime="2022-03-23T14:34:51+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Mar 23, 2022
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 9 mins</span>
  </p></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h2 id="introdução">Introdução</h2>

<p>Esse artigo tem como objetivo dismitificar o uso de logs nas nossa aplicações. E para nos guiarmos nesse processo tentaremos responder algumas perguntas como: <strong>O que são logs? Para que servem? Como escrever logs relevantes?</strong>. Esse é um tema pode parecer simples mas grande parte dos engenheiros de software apesar de conhecerem não são familiarizados com o conceito, segundo  <a href="[www.linkedin.com](https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying)">esse artigo</a> da equipe de engenharia do linkedin e nos iremos mudar isso hoje!</p>

<p><img src="https://c.tenor.com/8SwMrENO6AEAAAAM/pikachu-togepi.gif" alt="Pokemons rolling on a log" /></p>

<h2 id="definição">Definição</h2>
<p>Uma possível definição técnica que eu particularmente gosto é de que talvez os logs sejam a forma mais simples possível de abstração de armazenamento, eles são sequências de registros ordedenados pela data de criação e possuem duas propriedades, todo arquivo de log deve ser <a href="https://en.wikipedia.org/wiki/Append-only"><em>append-only</em></a> e <a href="https://mathworld.wolfram.com/TotallyOrderedSet.html"><em>totally-ordered</em></a>. De modo simples, <em>append-only</em> significa que o arquivo de log suporta apenas inserção de dados e os dados já existentes devem ser imutáveis e <em>totally-ordered</em> é uma propriedade que nos grante que existe uma ordem em todos elementos do conjunto (nesse caso nosso arquivo de log) e que pegando quaisquer dois elementos desse conjunto conseguimos dizer qual veio primeiro e qual veio por último.</p>

<p><img src="https://cdn.dribbble.com/users/6319642/screenshots/14533255/sorting.gif" alt="Ordenando itens" /></p>

<h2 id="principais-finalidades">Principais finalidades</h2>
<p>Existem diversos tipos e finalidades de logs como os <a href="https://www.ibm.com/docs/en/db2/11.5?topic=strategies-database-logging">transaction logs</a> que são utilizados por diversos bancos de dados para realizar um fallback dos dados em caso de falha de uma transação. Existem também os logs utlizados por <a href="https://www.rapid7.com/blog/post/2018/01/16/taking-a-message-based-approach-to-logging/">serviços de mensageria para criação de tópicos e mensagens</a> apesar de ser bom saber que um mesmo conceito pode ser aplicado em situações diferentes nosso objetivo aqui é focar na utilização de logs para monitoramento e auxilio na solução de possíveis problemas na nossa aplicação e esses logs são popularmente conhecidos como <a href="https://www.xplg.com/application-logs-what-how">application logs</a>.</p>

<h2 id="observabilidade">Observabilidade</h2>
<p>Os logs são comumente utilizados para auxiliar no diágnostico de problemas e no processo de observação do comportamento de uma aplicação, principalmente em sistemas de <a href="https://pt.wikipedia.org/wiki/Aplica%C3%A7%C3%A3o_monol%C3%ADtica">arquitetura monolitica</a>. Porém com a popularização da <a href="https://www.redhat.com/pt-br/topics/microservices">arquitetura de microsserviços</a> apesar de eles continuarem sendo utilizados para esse fim eles passaram a ser considerados como parte de um conceito mais amplo a <a href="https://aws.amazon.com/pt/products/management-and-governance/use-cases/monitoring-and-observability/">observabilidade</a>. Os pilares da observabilidade segundo <a href="https://www.linkedin.com/pulse/import%C3%A2ncia-da-observabilidade-em-aplica%C3%A7%C3%B5es-modernas-felipe-neves/?originalSubdomain=pt">este artigo</a> são as métricas, eventos, traces e <strong>logs</strong>. Neste texto iremos abordar boas práticas na escrita de logs focando no objetivo de melhorar a observabilidade de nossas aplicações e os outros pilares serão abordados em posts futuros.</p>

<p><img src="https://reev.co/wp-content/uploads/2016/07/gifs-contam-uma-historia.gif" alt="logs não são coisa do passado" /></p>

<h2 id="como-escrever-logs-relavantes">Como escrever LOGs relavantes?</h2>
<p>Tendo em mente o conceito de observabilidade e como os logs funcionam reuni algumas dicas de como escrever logs para que eles nos forneçam informações detalhadas sobre o que acontece na nossa e de fato nos ajudar no processo de monitoramento e correção de problemas no fluxo da nossa aplicação.</p>

<h3 id="1-padronize-a-escrita-de-logs">1. Padronize a escrita de logs</h3>
<p>Os <a href="https://www.php-fig.org/psr/">PSRs (PHP Stardard Recommendation)</a> tem uma <a href="https://www.php-fig.org/psr/psr-3/">seção especifica</a> para como devemos escrever nossas classes de logs. Mas nem sempre precisamos reinventar a roda, existem diversos pacotes mantidos pela comunidade e amplamente utilizados que podemos utilizar em nossos projetos sem nos precuparmos em implementar essas diretrizes, mas é sempre importante entender o que estamos fazendo.</p>

<h4 id="11-pacotes-populares-para-logs-em-php">1.1. Pacotes populares para logs em php</h4>
<ol>
  <li><a href="https://github.com/Seldaek/monolog">Monolog</a> - É uma das bibliotecas mais utilizadas no mercado e é utilizada nativamente pelos principais frameworks PHP da atualidade como: Laravel, Symphony, Lumen, CakePHP, Slim, entre outros…</li>
  <li><a href="https://github.com/jbroadway/analog">Analog</a> - Apesar de não ser tão popular essa biblioteca tem a premissa de ser otimizada para criação de logs de forma simples, configurável e extensível.</li>
  <li><a href="https://github.com/katzgrau/KLogger">KLogger</a> - Essa biblioteca também mantida pela comunidade é utilizada em algumas universades dos EUA e assim como as outras segue as especificações da PSR-3.</li>
</ol>

<h3 id="2-sempre-use-os-níveis-de-log">2. Sempre use os níveis de log</h3>
<p>Os <a href="https://www.php-fig.org/psr/psr-3/">PSRs</a> especificam oito níveis de mensagens de log que não são arbitrários, eles seguem o protocolo <a href="https://datatracker.ietf.org/doc/html/rfc5424">RFC-5424</a> que faz parte de um conjunto de regras definidas para padrozinar o que é implementado na internet. E por esse motivo temos oito níveis de logs, que são eles em ordem de criticidade:</p>
<ol>
  <li><strong>emergency</strong>: Deve ser utilizado quando o sistema está completamente não utilizavel.</li>
  <li><strong>alert</strong>: Deve ser utilizado quando uma ação precisa ser tomada imediatamente.</li>
  <li><strong>critical</strong>: Deve ser utilizado quando algum componente está indisponível, normalmente quando é uma exceção não esperada.</li>
  <li><strong>error</strong>: Deve ser utilizado para erros de execução que normalmente não precisam de uma ação no momento em que ocorrem mas precisam ser monitorados.</li>
  <li><strong>warning</strong>: Deve ser utilizado para comportamentos anormais no sistema que não necessáriamente sejam erros, como por exemplo, uso de API’s desafadas ou mal uso de uma API.</li>
  <li><strong>notice</strong>: Deve ser utilizado para eventos que ocorrem normalmente mas que são siginificantes para o monitoramento.</li>
  <li><strong>info</strong>: Deve ser utilizado para eventos que são interessantes de serem observados no fluxo da aplicação, como por exemplo: “Usuário {id} logou no MYSQL”.</li>
  <li><strong>debug</strong>: Deve ser utilizado para salvar informação detalhada de depuração de erros e/ou um determinado fluxo do sistema.</li>
</ol>

<h3 id="3-escreva-mensagens-descritivas-e-contextualizadas">3. Escreva mensagens descritivas e contextualizadas</h3>

<p>Os logs precisam nos ajudar a entender o fluxo da nossa aplicação então messagens como os exemplos abaixo dificilmente irão nos ajudar nisso:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">error</span><span class="p">(</span><span class="s2">"Algo deu errado"</span><span class="p">);</span>
  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">error</span><span class="p">(</span><span class="s2">"Banco de dados não esta funcionando"</span><span class="p">);</span>
</code></pre></div></div>
<p>As mensagens acima não nos dão um caminho de o que e nem onde está acontecendo o problema Um exemplo de mensagem que nos ajuda a entender problemas no fluxo precisa espeficar</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">error</span><span class="p">(</span><span class="s2">"[Atualização Usuário] Não foi foi possível atualizar dados do usuário de id: </span><span class="si">{</span><span class="nv">$id</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>
  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">info</span><span class="p">(</span><span class="s2">"[App\Services\ExternalApiService] Protolo número </span><span class="si">{</span><span class="nv">$protocolNumber</span><span class="si">}</span><span class="s2"> atualizado com sucesso."</span><span class="p">);</span>
  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">warning</span><span class="p">(</span><span class="s2">"[App\Services\ExternalApiService] Não foi possível atualizar o protolo número </span><span class="si">{</span><span class="nv">$protocolNumber</span><span class="si">}</span><span class="s2">: API Indisponível."</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="4-não-logue-apenas-exceções">4. Não logue apenas exceções</h3>
<p>Caso haja a necessidade de criar logs para determinadas exceções evite logar somente a stacktrace pois ela normalmente devolve apenas quais linhas de código geraram aquela exceção e díficilmente tem os dados geraram aquele problema, por isso evite fazer como no exemplo abaixo:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
  <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'some'</span> <span class="o">=&gt;</span> <span class="s1">'data'</span><span class="p">];</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">apiService</span><span class="o">-&gt;</span><span class="nf">getUserData</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">AnErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">debug</span><span class="p">(</span><span class="s2">"Caiu em uma excessão."</span><span class="p">,</span> <span class="p">[</span><span class="s1">'exception'</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Lembre-se que os logs são uma parte importante da observabilidade e é preciso que ele forneça um contexto que possa ajudar a quem está monitorando a situação a entender aquele determinado fluxo para sanar eventuais problemas.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
  <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'some'</span> <span class="o">=&gt;</span> <span class="s1">'data'</span><span class="p">];</span>
  <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">apiService</span><span class="o">-&gt;</span><span class="nf">getUserData</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="err">\</span><span class="nc">AnErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">LoggerLibrary</span><span class="o">::</span><span class="nf">debug</span><span class="p">(</span><span class="s2">"[Serviço de API XPTO] Falha ao receber dados de cliente da API XPTO. Os seguintes dados foram utilizados."</span><span class="p">,</span> <span class="p">[</span><span class="s1">'exception'</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="p">,</span> <span class="s1">'data'</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="5-isso-é-realmente-necessário">5. Isso é realmente necessário?</h3>
<p>Quando vamos escrever mensagens de log para nossa aplicação precisamos lembrar que estamos descrevendo um fluxo do nosso sistema que precisa ser monitorado. Então antes de sair criando mensagens de log para cada trecho do código precisamos compreender o contexto e se a criação dessas mensagens irá colaborar de maneira positiva para o monitoramento do funcionamento da nossa aplicação.</p>

<h3 id="6-padronize-mas-tenha-em-mente-que-as-coisas-podem-mudar">6. Padronize, mas tenha em mente que as coisas podem mudar</h3>
<p>Sabemos que os logs podem ser feitos para serem lidos por humanos e por máquinas e além disso conforme a nossa aplicação evolui novas necessidades surgem e utilizar <a href="https://en.wikipedia.org/wiki/Plain_text">textos planos</a> pode deixar de ser uma boa opção. Por isso é importante a outras maneiras de realizar o parsing de nossos logs como por exemplo em JSON. A biblioteca <a href="https://github.com/Seldaek/monolog/blob/main/src/Monolog/Formatter/JsonFormatter.php">Monolog</a> possui um parser pronto pra você salvar seus logs em JSON e neste <a href="https://www.loggly.com/use-cases/json-logging-best-practices/">link</a> você encontra algumas dicas de como criar bons logs em JSON.</p>

<h2 id="conclusão">Conclusão</h2>
<p>Os logs são um dos pilares da observabilidade e quanto mais entendemos da nossa aplicação mais fácil se torna escrever fluxos que nos ajudem a entender a saúde de nossos serviços. Essas dicas são um caminho para a escrita de logs que podem contribuir para melhorar a observabilidade dos nossos sistemas.</p>


    </div>

</article>
<div class="post-nav"><span></span><span></span></div><div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/php-architect/logs/event-sourcing/good-pratices/observability/2022/03/23/best-practices-on-application-logging.html" title="">Melhorando a observabilidade: Boas práticas na escrita de LOGS</a></li></ul>
    </div><div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/php-architect/"></data>

  <div class="wrapper">
    <div class="site-footer-inner"><div></div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/php-architect/feed.xml">via RSS</a></div>
    </div>
  </div>
</footer>
</body>
</html>
